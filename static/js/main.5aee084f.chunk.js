(this["webpackJsonpopenvidu-call-react"]=this["webpackJsonpopenvidu-call-react"]||[]).push([[0],{113:function(e,t,i){},230:function(e,t,i){e.exports=i(391)},235:function(e,t,i){},253:function(e,t,i){},371:function(e,t,i){},378:function(e,t,i){},388:function(e,t,i){},391:function(e,t,i){"use strict";i.r(t);var n=i(0),a=i.n(n),s=i(28),o=i.n(s),r=(i(235),i(10)),c=i(11),l=i(22),h=i(21),u=i(2),d=i(23),m=i(89),g=i.n(m),v=(i(253),i(133)),p=(i(113),function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e))).videoRef=a.a.createRef(),i}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props&&this.props.user.streamManager&&this.videoRef&&(console.log("PROPS: ",this.props),this.props.user.getStreamManager().addVideoElement(this.videoRef.current)),this.props&&this.props.user.streamManager.session&&this.props.user&&this.videoRef&&this.props.user.streamManager.session.on("signal:userChanged",(function(t){void 0!==JSON.parse(t.data).isScreenShareActive&&e.props.user.getStreamManager().addVideoElement(e.videoRef.current)}))}},{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.user.getStreamManager().addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return a.a.createElement("video",{autoPlay:!0,id:"video-"+this.props.user.getStreamManager().stream.streamId,ref:this.videoRef,muted:this.props.mutedSound})}}]),t}(n.Component)),S=i(65),f=i.n(S),b=i(64),y=i.n(b),k=i(136),E=i.n(k),C=i(135),O=i.n(C),R=i(53),N=i.n(R),w=i(55),A=i.n(w),j=i(54),I=i.n(j),x=i(19),M=i.n(x),V=i(63),U=i.n(V),T=i(40),F=i.n(T),D=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={nickname:i.props.user.getNickname(),showForm:!1,mutedSound:!1,isFormValid:!0},i.handleChange=i.handleChange.bind(Object(u.a)(i)),i.handlePressKey=i.handlePressKey.bind(Object(u.a)(i)),i.toggleNicknameForm=i.toggleNicknameForm.bind(Object(u.a)(i)),i.toggleSound=i.toggleSound.bind(Object(u.a)(i)),i}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e){this.setState({nickname:e.target.value}),e.preventDefault()}},{key:"toggleNicknameForm",value:function(){this.props.user.isLocal()&&this.setState({showForm:!this.state.showForm})}},{key:"toggleSound",value:function(){this.setState({mutedSound:!this.state.mutedSound})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&(console.log(this.state.nickname),this.state.nickname.length>=3&&this.state.nickname.length<=20?(this.props.handleNickname(this.state.nickname),this.toggleNicknameForm(),this.setState({isFormValid:!0})):this.setState({isFormValid:!1}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"OT_widget-container"},a.a.createElement("div",{className:"pointer nickname"},this.state.showForm?a.a.createElement(N.a,{id:"nicknameForm"},a.a.createElement(M.a,{color:"inherit",id:"closeButton",onClick:this.toggleNicknameForm},a.a.createElement(U.a,null)),a.a.createElement(I.a,{htmlFor:"name-simple",id:"label"},"Nickname"),a.a.createElement(A.a,{color:"inherit",id:"input",value:this.state.nickname,onChange:this.handleChange,onKeyPress:this.handlePressKey,required:!0}),!this.state.isFormValid&&this.state.nickname.length<=3&&a.a.createElement(F.a,{id:"name-error-text"},"Nickname is too short!"),!this.state.isFormValid&&this.state.nickname.length>=20&&a.a.createElement(F.a,{id:"name-error-text"},"Nickname is too long!")):a.a.createElement("div",{onClick:this.toggleNicknameForm},a.a.createElement("span",{id:"nickname"},this.props.user.getNickname()),this.props.user.isLocal()&&a.a.createElement("span",null," (edit)"))),void 0!==this.props.user&&void 0!==this.props.user.getStreamManager()?a.a.createElement("div",{className:"streamComponent"},a.a.createElement(p,{user:this.props.user,mutedSound:this.state.mutedSound}),a.a.createElement("div",{id:"statusIcons"},this.props.user.isVideoActive()?null:a.a.createElement("div",{id:"camIcon"},a.a.createElement(y.a,{id:"statusCam"})),this.props.user.isAudioActive()?null:a.a.createElement("div",{id:"micIcon"},a.a.createElement(f.a,{id:"statusMic"}))),a.a.createElement("div",null,!this.props.user.isLocal()&&a.a.createElement(M.a,{id:"volumeButton",onClick:this.toggleSound},this.state.mutedSound?a.a.createElement(O.a,{color:"secondary"}):a.a.createElement(E.a,null)))):null)}}]),t}(n.Component),L=i(56),P=i.n(L),_=i(58),B=i.n(_),W=i(57),z=i.n(W),q=i(41),H=i.n(q),K=i(31),J=i.n(K),Y=(i(371),function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e))).openviduExtensionUrl="https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",i.state={isInstalled:!1},i.goToChromePage=i.goToChromePage.bind(Object(u.a)(i)),i.onNoClick=i.onNoClick.bind(Object(u.a)(i)),i.refreshBrowser=i.refreshBrowser.bind(Object(u.a)(i)),i}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){}},{key:"onNoClick",value:function(){this.props.cancelClicked()}},{key:"goToChromePage",value:function(){window.open(this.openviduExtensionUrl),this.setState({isInstalled:!0})}},{key:"refreshBrowser",value:function(){window.location.reload()}},{key:"render",value:function(){return a.a.createElement("div",null,this.props&&this.props.showDialog?a.a.createElement("div",{id:"dialogExtension"},a.a.createElement(P.a,{id:"card"},a.a.createElement(z.a,null,a.a.createElement(H.a,{color:"textSecondary"},"Hello"),a.a.createElement(H.a,{color:"textSecondary"},"You need install this chrome extension and refresh the browser for can share your screen.")),a.a.createElement(B.a,null,a.a.createElement(J.a,{size:"small",onClick:this.onNoClick},"Cancel"),a.a.createElement(J.a,{size:"small",onClick:this.goToChromePage},"Install"),this.state.isInstalled?a.a.createElement(J.a,{size:"small",onClick:this.refreshBrowser},"Refresh"):null))):null)}}]),t}(n.Component)),X=i(60),G=i.n(X),Q=i(138),$=i.n(Q),Z=(i(378),i(137)),ee=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={messageList:[],message:""},i.chatScroll=a.a.createRef(),i.handleChange=i.handleChange.bind(Object(u.a)(i)),i.handlePressKey=i.handlePressKey.bind(Object(u.a)(i)),i.close=i.close.bind(Object(u.a)(i)),i.sendMessage=i.sendMessage.bind(Object(u.a)(i)),i}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.user.getStreamManager().stream.session.on("signal:chat",(function(t){var i=JSON.parse(t.data),n=e.state.messageList;n.push({connectionId:t.from.connectionId,nickname:i.nickname,message:i.message});var a=window.document;setTimeout((function(){var t=a.getElementById("userImg-"+(e.state.messageList.length-1)),n=a.getElementById("video-"+i.streamId);t.getContext("2d").drawImage(n,200,120,285,285,0,0,60,60),e.props.messageReceived()}),50),e.setState({messageList:n}),e.scrollToBottom()}))}},{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&this.sendMessage()}},{key:"sendMessage",value:function(){if(console.log(this.state.message),this.props.user&&this.state.message){var e=this.state.message.replace(/ +(?= )/g,"");if(""!==e&&" "!==e){var t={message:e,nickname:this.props.user.getNickname(),streamId:this.props.user.getStreamManager().stream.streamId};this.props.user.getStreamManager().stream.session.signal({data:JSON.stringify(t),type:"chat"})}}this.setState({message:""})}},{key:"scrollToBottom",value:function(){var e=this;setTimeout((function(){try{e.chatScroll.current.scrollTop=e.chatScroll.current.scrollHeight}catch(t){}}),20)}},{key:"close",value:function(){this.props.close(void 0)}},{key:"render",value:function(){var e=this,t={display:this.props.chatDisplay};return a.a.createElement("div",{id:"chatContainer"},a.a.createElement("div",{id:"chatComponent",style:t},a.a.createElement("div",{id:"chatToolbar"},a.a.createElement("span",null,this.props.user.getStreamManager().stream.session.sessionId," - CHAT"),a.a.createElement(M.a,{id:"closeButton",onClick:this.close},a.a.createElement(U.a,{color:"secondary"}))),a.a.createElement("div",{className:"message-wrap",ref:this.chatScroll},this.state.messageList.map((function(t,i){return a.a.createElement("div",{key:i,id:"remoteUsers",className:"message"+(t.connectionId!==e.props.user.getConnectionId()?" left":" right")},a.a.createElement("canvas",{id:"userImg-"+i,width:"60",height:"60",className:"user-img"}),a.a.createElement("div",{className:"msg-detail"},a.a.createElement("div",{className:"msg-info"},a.a.createElement("p",null," ",t.nickname)),a.a.createElement("div",{className:"msg-content"},a.a.createElement("span",{className:"triangle"}),a.a.createElement("p",{className:"text"},t.message))))}))),a.a.createElement("div",{id:"messageInput"},a.a.createElement("input",{placeholder:"Send a messge",id:"chatInput",value:this.state.message,onChange:this.handleChange,onKeyPress:this.handlePressKey}),a.a.createElement(Z.a,{title:"Send message"},a.a.createElement(G.a,{size:"small",id:"sendButton",onClick:this.sendMessage},a.a.createElement($.a,null))))))}}]),t}(n.Component),te=i(25),ie=i.n(te),ne=function(){function e(){Object(r.a)(this,e)}return Object(c.a)(e,[{key:"fixAspectRatio",value:function(e,t){var i=e.querySelector(".OT_root");if(i){var n=i.style.width;i.style.width=t+"px",i.style.width=n||""}}},{key:"positionElement",value:function(e,t,i,n,a,s){var o=this,r={left:t+"px",top:i+"px",width:n+"px",height:a+"px"};this.fixAspectRatio(e,n),s&&ie.a?(ie()(e).stop(),ie()(e).animate(r,s.duration||200,s.easing||"swing",(function(){o.fixAspectRatio(e,n),s.complete&&s.complete.call(o)}))):ie()(e).css(r),this.fixAspectRatio(e,n)}},{key:"getVideoRatio",value:function(e){if(!e)return.75;var t=e.querySelector("video");return t&&t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:e.videoHeight&&e.videoWidth?e.videoHeight/e.videoWidth:.75}},{key:"getCSSNumber",value:function(e,t){var i=ie()(e).css(t);return i?parseInt(i,10):0}},{key:"cheapUUID",value:function(){return(1e8*Math.random()).toFixed(0)}},{key:"getHeight",value:function(e){var t=ie()(e).css("height");return t?parseInt(t,10):0}},{key:"getWidth",value:function(e){var t=ie()(e).css("width");return t?parseInt(t,10):0}},{key:"getBestDimensions",value:function(e,t,i,n,a,s){for(var o,r,c,l,h,u,d,m=1;m<=i;m++){var g=m,v=Math.ceil(i/g);(d=(u=Math.floor(a/v))/(h=Math.floor(n/g)))>t?u=h*(d=t):d<e&&(h=u/(d=e));var p=h*u*i;(void 0===o||p>o)&&(o=p,s=u,l=h,r=g,c=v)}return{maxArea:o,targetCols:r,targetRows:c,targetHeight:s,targetWidth:l,ratio:s/l}}},{key:"arrange",value:function(e,t,i,n,a,s,o,r,c){var l,h,u=e.length;if(s){var d=this.getVideoRatio(e.length>0?e[0]:null);h=this.getBestDimensions(d,d,u,t,i,l)}else h=this.getBestDimensions(o,r,u,t,i,l);for(var m,g=0,v=0,p=[],S=0;S<e.length;S++){S%h.targetCols===0&&(m={children:[],width:0,height:0},p.push(m));var f=e[S];m.children.push(f);var b=h.targetWidth;l=h.targetHeight,s&&(b=l/this.getVideoRatio(f)),m.width+=b,m.height=l}for(var y=0,k=0,E=0;E<p.length;E++)(m=p[E]).width>t?(m.height=Math.floor(m.height*(t/m.width)),m.width=t):m.width<t&&(k+=1),y+=m.height;if(y<i&&k>0){var C=i-y;y=0;for(var O=0;O<p.length;O++){if((m=p[O]).width<t){var R=C/k;R/m.height>(t-m.width)/m.width&&(R=Math.floor((t-m.width)/m.width*m.height)),m.width+=Math.floor(R/m.height*m.width),m.height+=R,C-=R,k-=1}y+=m.height}}v=(i-y)/2;for(var N=0;N<p.length;N++){g=(t-(m=p[N]).width)/2;for(var w=0;w<m.children.length;w++){var A=m.children[w],j=h.targetWidth;l=m.height,s&&(j=Math.floor(l/this.getVideoRatio(A))),A.style.position="absolute";var I=j-this.getCSSNumber(A,"paddingLeft")-this.getCSSNumber(A,"paddingRight")-this.getCSSNumber(A,"marginLeft")-this.getCSSNumber(A,"marginRight")-this.getCSSNumber(A,"borderLeft")-this.getCSSNumber(A,"borderRight"),x=l-this.getCSSNumber(A,"paddingTop")-this.getCSSNumber(A,"paddingBottom")-this.getCSSNumber(A,"marginTop")-this.getCSSNumber(A,"marginBottom")-this.getCSSNumber(A,"borderTop")-this.getCSSNumber(A,"borderBottom");this.positionElement(A,g+n,v+a,I,x,c),g+=j}v+=l}}},{key:"filterDisplayNone",value:function(e){return"none"!==e.style.display}},{key:"updateLayout",value:function(){if("none"!==this.layoutContainer.style.display){var e=this.layoutContainer.id;e||(e="OT_"+this.cheapUUID(),this.layoutContainer.id=e);var t,i,n=this.getHeight(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderTop")-this.getCSSNumber(this.layoutContainer,"borderBottom"),a=this.getWidth(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderLeft")-this.getCSSNumber(this.layoutContainer,"borderRight"),s=n/a,o=0,r=0,c=0,l=0,h=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">."+this.opts.bigClass),this.filterDisplayNone),u=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">*:not(."+this.opts.bigClass+")"),this.filterDisplayNone);if(h.length>0&&u.length>0)s>this.getVideoRatio(h[0])?(t=a,c=n-(r=i=Math.floor(n*this.opts.bigPercentage))):(i=n,l=a-(o=t=Math.floor(a*this.opts.bigPercentage))),this.opts.bigFirst?(this.arrange(h,t,i,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate),this.arrange(u,a-o,n-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)):(this.arrange(u,a-o,n-r,0,0,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate),this.arrange(h,t,i,l,c,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate));else h.length>0&&0===u.length?this.arrange(h,a,n,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate):this.arrange(u,a-o,n-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)}}},{key:"initLayoutContainer",value:function(e,t){this.opts={maxRatio:null!=t.maxRatio?t.maxRatio:1.5,minRatio:null!=t.minRatio?t.minRatio:9/16,fixedRatio:null!=t.fixedRatio&&t.fixedRatio,animate:null!=t.animate&&t.animate,bigClass:null!=t.bigClass?t.bigClass:"OT_big",bigPercentage:null!=t.bigPercentage?t.bigPercentage:.8,bigFixedRatio:null!=t.bigFixedRatio&&t.bigFixedRatio,bigMaxRatio:null!=t.bigMaxRatio?t.bigMaxRatio:1.5,bigMinRatio:null!=t.bigMinRatio?t.bigMinRatio:9/16,bigFirst:null==t.bigFirst||t.bigFirst},this.layoutContainer="string"===typeof e?ie()(e):e}},{key:"setLayoutOptions",value:function(e){this.opts=e}}]),e}(),ae=function(){function e(){Object(r.a)(this,e),this.connectionId="",this.audioActive=!0,this.videoActive=!0,this.screenShareActive=!1,this.nickname="",this.streamManager=null,this.type="local"}return Object(c.a)(e,[{key:"isAudioActive",value:function(){return this.audioActive}},{key:"isVideoActive",value:function(){return this.videoActive}},{key:"isScreenShareActive",value:function(){return this.screenShareActive}},{key:"getConnectionId",value:function(){return this.connectionId}},{key:"getNickname",value:function(){return this.nickname}},{key:"getStreamManager",value:function(){return this.streamManager}},{key:"isLocal",value:function(){return"local"===this.type}},{key:"isRemote",value:function(){return!this.isLocal()}},{key:"setAudioActive",value:function(e){this.audioActive=e}},{key:"setVideoActive",value:function(e){this.videoActive=e}},{key:"setScreenShareActive",value:function(e){this.screenShareActive=e}},{key:"setStreamManager",value:function(e){this.streamManager=e}},{key:"setConnectionId",value:function(e){this.connectionId=e}},{key:"setNickname",value:function(e){this.nickname=e}},{key:"setType",value:function(e){"local"===e|"remote"===e&&(this.type=e)}}]),e}(),se=(i(388),i(61)),oe=i.n(se),re=i(62),ce=i.n(re),le=i(139),he=i.n(le),ue=i(140),de=i.n(ue),me=i(145),ge=i.n(me),ve=i(144),pe=i.n(ve),Se=i(141),fe=i.n(Se),be=i(142),ye=i.n(be),ke=i(143),Ee=i.n(ke),Ce=i(59),Oe=i.n(Ce),Re=i(146),Ne=i.n(Re),we=i(147),Ae=i.n(we),je=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={fullscreen:!1},i.camStatusChanged=i.camStatusChanged.bind(Object(u.a)(i)),i.micStatusChanged=i.micStatusChanged.bind(Object(u.a)(i)),i.screenShare=i.screenShare.bind(Object(u.a)(i)),i.stopScreenShare=i.stopScreenShare.bind(Object(u.a)(i)),i.toggleFullscreen=i.toggleFullscreen.bind(Object(u.a)(i)),i.leaveSession=i.leaveSession.bind(Object(u.a)(i)),i.toggleChat=i.toggleChat.bind(Object(u.a)(i)),i}return Object(d.a)(t,e),Object(c.a)(t,[{key:"micStatusChanged",value:function(){this.props.micStatusChanged()}},{key:"camStatusChanged",value:function(){this.props.camStatusChanged()}},{key:"screenShare",value:function(){this.props.screenShare()}},{key:"stopScreenShare",value:function(){this.props.stopScreenShare()}},{key:"toggleFullscreen",value:function(){this.setState({fullscreen:!this.state.fullscreen}),this.props.toggleFullscreen()}},{key:"leaveSession",value:function(){this.props.leaveSession()}},{key:"toggleChat",value:function(){this.props.toggleChat()}},{key:"render",value:function(){var e=this.props.sessionId,t=this.props.user;return a.a.createElement(oe.a,{className:"toolbar",id:"header"},a.a.createElement(ce.a,{className:"toolbar"},a.a.createElement("div",{id:"navSessionInfo"},a.a.createElement("img",{id:"header_img",alt:"OpenVidu Logo",src:"https://raw.githubusercontent.com/OpenVidu/openvidu-call/master/front/openvidu-call/src/assets/images/openvidu_logo.png"}),this.props.sessionId&&a.a.createElement("div",{id:"titleContent"},a.a.createElement("span",{id:"session-title"},e))),a.a.createElement("div",{className:"buttonsContent"},a.a.createElement(M.a,{color:"inherit",className:"navButton",id:"navMicButton",onClick:this.micStatusChanged},void 0!==t&&t.isAudioActive()?a.a.createElement(he.a,null):a.a.createElement(f.a,{color:"secondary"})),a.a.createElement(M.a,{color:"inherit",className:"navButton",id:"navCamButton",onClick:this.camStatusChanged},void 0!==t&&t.isVideoActive()?a.a.createElement(de.a,null):a.a.createElement(y.a,{color:"secondary"})),a.a.createElement(M.a,{color:"inherit",className:"navButton",onClick:this.screenShare},void 0!==t&&t.isScreenShareActive()?a.a.createElement(fe.a,null):a.a.createElement(ye.a,null)),void 0!==t&&t.isScreenShareActive()&&a.a.createElement(M.a,{onClick:this.stopScreenShare,id:"navScreenButton"},a.a.createElement(Ee.a,{color:"secondary"})),a.a.createElement(M.a,{color:"inherit",className:"navButton",onClick:this.toggleFullscreen},void 0!==t&&this.state.fullscreen?a.a.createElement(pe.a,null):a.a.createElement(ge.a,null)),a.a.createElement(M.a,{color:"secondary",className:"navButton",onClick:this.leaveSession,id:"navLeaveButton"},a.a.createElement(Ne.a,null)),a.a.createElement(M.a,{color:"inherit",onClick:this.toggleChat,id:"navChatButton"},this.props.showNotification&&a.a.createElement("div",{id:"point",className:""}),a.a.createElement(Oe.a,{title:"Chat"},a.a.createElement(Ae.a,null))))))}}]),t}(n.Component),Ie=new ae,xe=function(e){function t(e){var i;Object(r.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e))).OPENVIDU_SERVER_URL="https://stream.vconf.in.th",i.OPENVIDU_SERVER_SECRET="Telemed1",i.hasBeenUpdated=!1,i.layout=new ne;var n=i.props.sessionName?i.props.sessionName:"SessionA",a=i.props.user?i.props.user:"OpenVidu_User"+Math.floor(100*Math.random());return i.state={mySessionId:n,myUserName:a,session:void 0,localUser:void 0,subscribers:[],chatDisplay:"none"},i.joinSession=i.joinSession.bind(Object(u.a)(i)),i.leaveSession=i.leaveSession.bind(Object(u.a)(i)),i.onbeforeunload=i.onbeforeunload.bind(Object(u.a)(i)),i.updateLayout=i.updateLayout.bind(Object(u.a)(i)),i.camStatusChanged=i.camStatusChanged.bind(Object(u.a)(i)),i.micStatusChanged=i.micStatusChanged.bind(Object(u.a)(i)),i.nicknameChanged=i.nicknameChanged.bind(Object(u.a)(i)),i.toggleFullscreen=i.toggleFullscreen.bind(Object(u.a)(i)),i.screenShare=i.screenShare.bind(Object(u.a)(i)),i.stopScreenShare=i.stopScreenShare.bind(Object(u.a)(i)),i.closeDialogExtension=i.closeDialogExtension.bind(Object(u.a)(i)),i.toggleChat=i.toggleChat.bind(Object(u.a)(i)),i.checkNotification=i.checkNotification.bind(Object(u.a)(i)),i.checkSize=i.checkSize.bind(Object(u.a)(i)),i}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.layout.initLayoutContainer(document.getElementById("layout"),{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0}),window.addEventListener("beforeunload",this.onbeforeunload),window.addEventListener("resize",this.updateLayout),window.addEventListener("resize",this.checkSize),this.joinSession()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload),window.removeEventListener("resize",this.updateLayout),window.removeEventListener("resize",this.checkSize),this.leaveSession()}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"joinSession",value:function(){var e=this;this.OV=new v.OpenVidu,this.setState({session:this.OV.initSession()},(function(){e.subscribeToStreamCreated(),e.connectToSession()}))}},{key:"connectToSession",value:function(){var e=this;void 0!==this.props.token?(console.log("token received: ",this.props.token),this.connect(this.props.token)):this.getToken().then((function(t){console.log(t),e.connect(t)})).catch((function(t){e.props.error&&e.props.error({error:t.error,messgae:t.message,code:t.code,status:t.status}),console.log("There was an error getting the token:",t.code,t.message),alert("There was an error getting the token:",t.message)}))}},{key:"connect",value:function(e){var t=this;this.state.session.connect(e,{clientData:this.state.myUserName}).then((function(){t.connectWebCam()})).catch((function(e){t.props.error&&t.props.error({error:e.error,messgae:e.message,code:e.code,status:e.status}),alert("There was an error connecting to the session:",e.message),console.log("There was an error connecting to the session:",e.code,e.message)}))}},{key:"connectWebCam",value:function(){var e=this,t=this.OV.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:Ie.isAudioActive(),publishVideo:Ie.isVideoActive(),resolution:"640x480",frameRate:30,insertMode:"APPEND"});this.state.session.capabilities.publish&&this.state.session.publish(t).then((function(){e.props.joinSession&&e.props.joinSession()})),Ie.setNickname(this.state.myUserName),Ie.setConnectionId(this.state.session.connection.connectionId),Ie.setScreenShareActive(!1),Ie.setStreamManager(t),this.subscribeToUserChanged(),this.subscribeToStreamDestroyed(),this.sendSignalUserChanged({isScreenShareActive:Ie.isScreenShareActive()}),this.setState({localUser:Ie},(function(){e.state.localUser.getStreamManager().on("streamPlaying",(function(i){e.updateLayout(),t.videos[0].video.parentElement.classList.remove("custom-class")}))}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"OpenVidu_User"+Math.floor(100*Math.random()),localUser:void 0}),this.props.leaveSession&&this.props.leaveSession()}},{key:"camStatusChanged",value:function(){Ie.setVideoActive(!Ie.isVideoActive()),Ie.getStreamManager().publishVideo(Ie.isVideoActive()),this.sendSignalUserChanged({isVideoActive:Ie.isVideoActive()}),this.setState({localUser:Ie})}},{key:"micStatusChanged",value:function(){Ie.setAudioActive(!Ie.isAudioActive()),Ie.getStreamManager().publishAudio(Ie.isAudioActive()),this.sendSignalUserChanged({isAudioActive:Ie.isAudioActive()}),this.setState({localUser:Ie})}},{key:"nicknameChanged",value:function(e){var t=this.state.localUser;t.setNickname(e),this.setState({localUser:t}),this.sendSignalUserChanged({nickname:this.state.localUser.getNickname()})}},{key:"deleteSubscriber",value:function(e){var t=this.state.subscribers,i=t.filter((function(t){return t.getStreamManager().stream===e}))[0],n=t.indexOf(i,0);n>-1&&(t.splice(n,1),this.setState({subscribers:t}))}},{key:"subscribeToStreamCreated",value:function(){var e=this;this.state.session.on("streamCreated",(function(t){var i=e.state.session.subscribe(t.stream,void 0),n=e.state.subscribers;i.on("streamPlaying",(function(t){e.checkSomeoneShareScreen(),i.videos[0].video.parentElement.classList.remove("custom-class")}));var a=new ae;a.setStreamManager(i),a.setConnectionId(t.stream.connection.connectionId),a.setType("remote");var s=t.stream.connection.data.split("%")[0];a.setNickname(JSON.parse(s).clientData),n.push(a),e.setState({subscribers:n},(function(){e.state.localUser&&e.sendSignalUserChanged({isAudioActive:e.state.localUser.isAudioActive(),isVideoActive:e.state.localUser.isVideoActive(),nickname:e.state.localUser.getNickname(),isScreenShareActive:e.state.localUser.isScreenShareActive()}),e.updateLayout()}))}))}},{key:"subscribeToStreamDestroyed",value:function(){var e=this;this.state.session.on("streamDestroyed",(function(t){e.deleteSubscriber(t.stream),setTimeout((function(){e.checkSomeoneShareScreen()}),20),t.preventDefault(),e.updateLayout()}))}},{key:"subscribeToUserChanged",value:function(){var e=this;this.state.session.on("signal:userChanged",(function(t){var i=e.state.subscribers;i.forEach((function(e){if(e.getConnectionId()===t.from.connectionId){var i=JSON.parse(t.data);console.log("EVENTO REMOTE: ",t.data),void 0!==i.isAudioActive&&e.setAudioActive(i.isAudioActive),void 0!==i.isVideoActive&&e.setVideoActive(i.isVideoActive),void 0!==i.nickname&&e.setNickname(i.nickname),void 0!==i.isScreenShareActive&&e.setScreenShareActive(i.isScreenShareActive)}})),e.setState({subscribers:i},(function(){return e.checkSomeoneShareScreen()}))}))}},{key:"updateLayout",value:function(){var e=this;setTimeout((function(){e.layout.updateLayout()}),20)}},{key:"sendSignalUserChanged",value:function(e){var t={data:JSON.stringify(e),type:"userChanged"};this.state.session.signal(t)}},{key:"toggleFullscreen",value:function(){var e=window.document,t=e.getElementById("container");e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}},{key:"screenShare",value:function(){var e=this,t=-1!==navigator.userAgent.indexOf("Firefox")?"window":"screen",i=this.OV.initPublisher(void 0,{videoSource:t,publishAudio:Ie.isAudioActive(),publishVideo:Ie.isVideoActive(),mirror:!1},(function(t){t&&"SCREEN_EXTENSION_NOT_INSTALLED"===t.name?e.setState({showExtensionDialog:!0}):t&&"SCREEN_SHARING_NOT_SUPPORTED"===t.name?alert("Your browser does not support screen sharing"):t&&"SCREEN_EXTENSION_DISABLED"===t.name?alert("You need to enable screen sharing extension"):t&&"SCREEN_CAPTURE_DENIED"===t.name&&alert("You need to choose a window or application to share")}));i.once("accessAllowed",(function(){e.state.session.unpublish(Ie.getStreamManager()),Ie.setStreamManager(i),e.state.session.publish(Ie.getStreamManager()).then((function(){Ie.setScreenShareActive(!0),e.setState({localUser:Ie},(function(){e.sendSignalUserChanged({isScreenShareActive:Ie.isScreenShareActive()})}))}))})),i.on("streamPlaying",(function(){e.updateLayout(),i.videos[0].video.parentElement.classList.remove("custom-class")}))}},{key:"closeDialogExtension",value:function(){this.setState({showExtensionDialog:!1})}},{key:"stopScreenShare",value:function(){this.state.session.unpublish(Ie.getStreamManager()),this.connectWebCam()}},{key:"checkSomeoneShareScreen",value:function(){var e={maxRatio:1.5,minRatio:9/16,fixedRatio:this.state.subscribers.some((function(e){return e.isScreenShareActive()}))||Ie.isScreenShareActive(),bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0};this.layout.setLayoutOptions(e),this.updateLayout()}},{key:"toggleChat",value:function(e){var t=e;void 0===t&&(t="none"===this.state.chatDisplay?"block":"none"),"block"===t?this.setState({chatDisplay:t,messageReceived:!1}):(console.log("chat",t),this.setState({chatDisplay:t})),this.updateLayout()}},{key:"checkNotification",value:function(e){this.setState({messageReceived:"none"===this.state.chatDisplay})}},{key:"checkSize",value:function(){document.getElementById("layout").offsetWidth<=700&&!this.hasBeenUpdated&&(this.toggleChat("none"),this.hasBeenUpdated=!0),document.getElementById("layout").offsetWidth>700&&this.hasBeenUpdated&&(this.hasBeenUpdated=!1)}},{key:"render",value:function(){var e=this.state.mySessionId,t=this.state.localUser,i={display:this.state.chatDisplay};return a.a.createElement("div",{className:"container",id:"container"},a.a.createElement(je,{sessionId:e,user:t,showNotification:this.state.messageReceived,camStatusChanged:this.camStatusChanged,micStatusChanged:this.micStatusChanged,screenShare:this.screenShare,stopScreenShare:this.stopScreenShare,toggleFullscreen:this.toggleFullscreen,leaveSession:this.leaveSession,toggleChat:this.toggleChat}),a.a.createElement(Y,{showDialog:this.state.showExtensionDialog,cancelClicked:this.closeDialogExtension}),a.a.createElement("div",{id:"layout",className:"bounds"},void 0!==t&&void 0!==t.getStreamManager()&&a.a.createElement("div",{className:"OT_root OT_publisher custom-class",id:"localUser"},a.a.createElement(D,{user:t,handleNickname:this.nicknameChanged})),this.state.subscribers.map((function(e,t){return a.a.createElement("div",{key:t,className:"OT_root OT_publisher custom-class",id:"remoteUsers"},a.a.createElement(D,{user:e,streamId:e.streamManager.stream.streamId}))})),void 0!==t&&void 0!==t.getStreamManager()&&a.a.createElement("div",{className:"OT_root OT_publisher custom-class",style:i},a.a.createElement(ee,{user:t,chatDisplay:this.state.chatDisplay,close:this.toggleChat,messageReceived:this.checkNotification}))))}},{key:"getToken",value:function(){var e=this;return this.createSession(this.state.mySessionId).then((function(t){return e.createToken(t)}))}},{key:"createSession",value:function(e){var t=this;return new Promise((function(i,n){var a=JSON.stringify({customSessionId:e});g.a.post(t.OPENVIDU_SERVER_URL+"/api/sessions",a,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+t.OPENVIDU_SERVER_SECRET),"Content-Type":"application/json"}}).then((function(e){console.log("CREATE SESION",e),i(e.data.id)})).catch((function(n){var a=Object.assign({},n);a.response&&409===a.response.status?i(e):(console.log(a),console.warn("No connection to OpenVidu Server. This may be a certificate error at "+t.OPENVIDU_SERVER_URL),window.confirm('No connection to OpenVidu Server. This may be a certificate error at "'+t.OPENVIDU_SERVER_URL+'"\n\nClick OK to navigate and accept it. If no certificate warning is shown, then check that your OpenVidu Server is up and running at "'+t.OPENVIDU_SERVER_URL+'"')&&window.location.assign(t.OPENVIDU_SERVER_URL+"/accept-certificate"))}))}))}},{key:"createToken",value:function(e){var t=this;return new Promise((function(i,n){var a=JSON.stringify({session:e});g.a.post(t.OPENVIDU_SERVER_URL+"/api/tokens",a,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+t.OPENVIDU_SERVER_SECRET),"Content-Type":"application/json"}}).then((function(e){console.log("TOKEN",e),i(e.data.token)})).catch((function(e){return n(e)}))}))}}]),t}(n.Component),Me=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ve(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(a.a.createElement(xe,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/test-ggg",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/test-ggg","/service-worker.js");Me?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ve(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Ve(e)}))}}()}},[[230,1,2]]]);
//# sourceMappingURL=main.5aee084f.chunk.js.map